# ArkData方舟数据管理子系统变更说明

## cl.kv_store.1 getKVStore接口错误码返回变更

**访问级别**

公开接口。

**变更原因**

针对文件系统在未解锁条件下不支持访问数据库文件的场景，将数据库损坏错误码15100003修正为数据库当前受限无法打开错误码15100006。

**变更影响**

该变更为不兼容变更。

变更前：在el2/el3/el4目录下，设备未解锁前不支持访问，会返回数据库损坏错误码15100003。

变更后：在el2/el3/el4目录下，设备未解锁前不支持访问，会返回数据库当前受限无法打开错误码15100006。

**起始 API Level**

9

**变更发生的版本**

从OpenHarmony SDK 5.0.0.51开始。

**变更的接口/组件**

getKVStore/分布式键值型数据库（distributedKVStore）

**适配指导**

在el2/el3/el4目录下，设备未解锁前不支持访问，会返回数据库当前受限无法打开错误码15100006，该错误码对应用无影响，业务可以选择是否捕获错误码，如果捕获，业务需要在合适的时机，例如设备解锁后，再正常访问数据库文件。

## cl.kv_store.2 backup & restore接口错误码返回变更

**访问级别**

公开接口。

**变更原因**

在数据库文件损坏场景下，调用backup备份操作，因之前实现BUG问题，导致备份操作会成功，产生了坏的备份文件；

在备份文件损坏场景下，调用restore恢复操作，因之前实现BUG问题，导致恢复会成功，使得数据库文件被损坏。

**变更影响**

该变更为不兼容变更。

变更前：在数据库文件损坏场景下，调用backup备份操作，会返回备份成功；在备份文件损坏场景下，调用restore恢复操作，会返回恢复成功。

变更后：在数据库文件损坏场景下，调用backup备份操作，会返回数据库损坏15100003；在备份文件损坏场景下，调用restore恢复操作，会返回数据库损坏15100003。

**起始 API Level**

9

**变更发生的版本**

从OpenHarmony SDK 5.0.0.51开始。

**变更的接口/组件**

backup/restore/分布式键值型数据库（distributedKVStore）

**适配指导**

在数据库文件损坏场景下，调用backup备份操作，会返回数据库损坏，此时无法备份，业务需根据损坏错误码进行对应处理；

在备份文件损坏场景下，调用restore恢复操作，会返回数据库损坏，此时备份文件损坏导致无法恢复，业务需重新生成数据写入数据库文件。
